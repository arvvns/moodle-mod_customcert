YUI.add("moodle-mod_customcert-rearrange",function(h,t){var n=function(){n.superclass.constructor.apply(this,[arguments])};h.extend(n,h.Base,{templateid:0,page:[],elements:[],elementxy:0,pixelsinmm:3.779527559055,initializer:function(t){this.templateid=t[0],this.page=t[1],this.elements=t[2],this.setpositions(),this.createevents(),window.addEventListener("resize",this.checkWindownResize.bind(this))},setpositions:function(){var t,e,i,n,s,o;for(t in this.elements){switch(e=this.elements[t],i=this.getPdfX()+e.posx*this.pixelsinmm,n=this.getPdfY()+e.posy*this.pixelsinmm,s=parseFloat(h.one("#element-"+e.id).getComputedStyle("width")),(o=e.width*this.pixelsinmm)&&o<s&&(s=o),e.refpoint){case"1":i-=s/2;break;case"2":i=i-s+2}h.one("#element-"+e.id).setX(i),h.one("#element-"+e.id).setY(n)}},getPdfX:function(){return h.one("#pdf").getX()},getPdfY:function(){return h.one("#pdf").getY()},getPdfWidth:function(){return parseFloat(h.one("#pdf").getComputedStyle("width"))},getPdfHeight:function(){return parseFloat(h.one("#pdf").getComputedStyle("height"))},getPdfLeftBoundary:function(){var t=this.getPdfX();return this.page.leftmargin&&(t+=parseInt(this.page.leftmargin*this.pixelsinmm,10)),t},getPdfRightBoundary:function(){var t=this.getPdfX()+this.getPdfWidth();return this.page.rightmargin&&(t-=parseInt(this.page.rightmargin*this.pixelsinmm,10)),t},checkWindownResize:function(){this.setpositions()},createevents:function(){h.one(".savepositionsbtn [type=submit]").on("click",function(t){this.savepositions(t)},this),h.one(".applypositionsbtn [type=submit]").on("click",function(t){this.savepositions(t),t.preventDefault()},this);var e=new h.DD.Delegate({container:"#pdf",nodes:".element"});e.on("drag:start",function(){var t=e.get("currentNode");this.elementxy=t.getXY()},this),e.on("drag:end",function(){var t=e.get("currentNode");this.isoutofbounds(t)&&t.setXY(this.elementxy)},this)},isoutofbounds:function(t){var e=parseFloat(t.getComputedStyle("width")),i=parseFloat(t.getComputedStyle("height")),n=t.getX(),e=n+e,t=t.getY(),i=t+i;return n<this.getPdfLeftBoundary()||e>this.getPdfRightBoundary()||(t<this.getPdfY()||i>this.getPdfY()+this.getPdfHeight())},savepositions:function(n){var t,e,i,s,o,a,r,d={tid:this.templateid,values:[]};for(t in this.elements){switch(e=this.elements[t],s=(i=h.one("#element-"+e.id)).getX()-this.getPdfX(),o=i.getY()-this.getPdfY(),a=i.getData("refpoint"),r=parseFloat(i.getComputedStyle("width")),a){case"1":s+=r/2;break;case"2":s+=r}d.values.push({id:e.id,posx:Math.round(parseFloat(s/this.pixelsinmm)),posy:Math.round(parseFloat(o/this.pixelsinmm))})}d.values=JSON.stringify(d.values),h.io(M.cfg.wwwroot+"/mod/customcert/ajax.php",{method:"POST",data:d,on:{failure:function(t,e){this.ajaxfailure(e)},success:function(){var t=n.currentTarget.ancestor("form",!0),e=t.getAttribute("action"),i=t.one("[name=pid]");i?(i=i.get("value"),window.location=e+"?pid="+i):(i=t.one("[name=tid]").get("value"),window.location=e+"?tid="+i)}},context:this}),n.preventDefault()},ajaxfailure:function(t){t={name:t.status+" "+t.statusText,message:t.responseText};return new M.core.exception(t)}}),h.namespace("M.mod_customcert.rearrange").init=function(t,e,i){new n(t,e,i)}},"@VERSION@",{requires:["dd-delegate","dd-drag"]});